#!/bin/bash

# =============================================================================
# –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢ - TelegrammBot
# =============================================================================

echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë          TelegrammBot - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç                      ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo ""
echo "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏:"
echo ""
echo "1. üöÄ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º SSL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)"
echo "   - –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É –±–µ–∑ –¥–æ–º–µ–Ω–∞"
echo "   - HTTPS –Ω–∞ –ª—é–±–æ–º IP"
echo "   - –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
echo ""
echo "2. üåê –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å Let's Encrypt SSL"
echo "   - –¢—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π –¥–æ–º–µ–Ω"
echo "   - –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–π SSL"
echo "   - –î–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Å–∞–π—Ç–æ–≤"
echo ""
echo "3. üì¶ –ë–∞–∑–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–µ–∑ SSL"
echo "   - –¢–æ–ª—å–∫–æ HTTP"
echo "   - –ë—ã—Å—Ç—Ä–µ–µ –≤—Å–µ–≥–æ"
echo "   - –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏"
echo ""
echo "4. üîß –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è)"
echo "   - –í—Å–µ –æ–ø—Ü–∏–∏"
echo "   - –®–∞–≥ –∑–∞ —à–∞–≥–æ–º"
echo ""
echo "0. ‚ùå –í—ã—Ö–æ–¥"
echo ""
read -p "–í–∞—à –≤—ã–±–æ—Ä (1-4): " CHOICE

case $CHOICE in
    1)
        echo ""
        echo "üöÄ –ó–∞–ø—É—Å–∫ –±—ã—Å—Ç—Ä–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º SSL..."
        echo ""
        
        # –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏
        export QUICK_INSTALL=true
        export SSL_TYPE=selfsigned
        ./setup.sh
        
        echo ""
        echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
        echo ""
        echo "üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
        echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: https://$(hostname -I | awk '{print $1}')"
        echo "2. –ü—Ä–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–∏ –Ω–∞–∂–º–∏—Ç–µ '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ' ‚Üí '–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç'"
        echo "3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: ./manage.sh"
        echo ""
        echo "üí° –°–º. SELF_SIGNED_SSL.md –¥–ª—è —É–±—Ä–∞–Ω–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–∞"
        ;;
    2)
        echo ""
        echo "üåê –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å Let's Encrypt..."
        echo ""
        read -p "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω: " DOMAIN
        echo ""
        echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ DNS..."
        ./check-dns.sh
        echo ""
        read -p "DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ? –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/n): " CONTINUE
        
        if [[ $CONTINUE =~ ^[Yy]$ ]]; then
            export QUICK_INSTALL=true
            export SSL_TYPE=letsencrypt
            export DOMAIN=$DOMAIN
            ./setup.sh
        else
            echo "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø—Ü–∏—é 1 –¥–ª—è —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ SSL."
        fi
        ;;
    3)
        echo ""
        echo "üì¶ –ó–∞–ø—É—Å–∫ –±–∞–∑–æ–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏..."
        echo ""
        export QUICK_INSTALL=true
        export SSL_TYPE=none
        ./setup.sh
        
        echo ""
        echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
        WEB_PORT=$(grep -E "^WEB_PORT=" config/domain.conf 2>/dev/null | cut -d'=' -f2 || echo "5000")
        echo "–î–æ—Å—Ç—É–ø: http://$(hostname -I | awk '{print $1}'):${WEB_PORT}"
        echo "–ü–æ—Ä—Ç –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤: config/domain.conf"
        ;;
    4)
        echo ""
        echo "üîß –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏..."
        ./setup.sh
        ;;
    0)
        echo "–í—ã—Ö–æ–¥..."
        exit 0
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
        exit 1
        ;;
esac
