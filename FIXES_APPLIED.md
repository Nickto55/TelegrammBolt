# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

## –î–∞—Ç–∞: $(Get-Date)

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –í—ã–±–æ—Ä —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∏ "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—É—é —Ä–æ–ª—å –¥–ª—è..." –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏

**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ callback –¥–ª—è `set_role_<user_id>_<role>`

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `set_role_` –≤ `commands.py` (—Å—Ç—Ä–æ–∫–∏ 1806-1820)
- –ü–∞—Ä—Å–∏—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç: `set_role_<user_id>_<role>`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `set_user_role()`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ

**–ö–æ–¥:**
```python
elif data.startswith('set_role_'):
    if get_user_role(user_id) == 'admin':
        parts = data.split('_')
        if len(parts) >= 4:
            target_user_id = parts[2]
            role_name = parts[3]
            if role_name in ROLES:
                set_user_role(target_user_id, role_name)
                await query.answer(f"‚úÖ –†–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞: {ROLES[role_name]}", show_alert=True)
                await show_admin_menu(update, context)
```

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `commands.py` (—Å—Ç—Ä–æ–∫–∏ 1806-1820)

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –í—ã–±–æ—Ä–æ—á–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç PDF

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∞ "–í—ã–±—Ä–∞—Ç—å –∑–∞–ø–∏—Å–∏" –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ –∑–∞–≥–ª—É—à–∫—É "–§—É–Ω–∫—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"

**–ü—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è `handle_pdf_export_select()` –Ω–µ –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**

### 1. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –î–°–ï (`pdf_generator.py`)

**`handle_pdf_export_select()`:**
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –î–°–ï –∑–∞–ø–∏—Å–∏
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ –Ω–æ–º–µ—Ä—É –î–°–ï
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ 10 –î–°–ï —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–ø–∏—Å–µ–π
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–±–æ—Ä–∞ –≤ `context.user_data`

**`handle_pdf_select_dse()`:**
- –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –≤—ã–±–æ—Ä –î–°–ï (–¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å)
- –û–±–Ω–æ–≤–ª—è–µ—Ç UI —Å –æ—Ç–º–µ—Ç–∫–∞–º–∏ ‚úÖ
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –î–°–ï

**`handle_pdf_export_selected()`:**
- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –î–°–ï –≤ PDF
- –ú–∞–∫—Å–∏–º—É–º 10 –∑–∞–ø–∏—Å–µ–π –Ω–∞ –î–°–ï
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PDF —Ñ–∞–π–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —ç–∫—Å–ø–æ—Ä—Ç–∞
- –û—á–∏—â–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–±–æ—Ä–∞

### 2. –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback (`commands.py`)

```python
elif data.startswith('pdf_select_dse_'):
    if has_permission(user_id, 'pdf_export'):
        from pdf_generator import handle_pdf_select_dse
        dse_name = data.replace('pdf_select_dse_', '')
        await handle_pdf_select_dse(update, context, dse_name)

elif data == 'pdf_export_selected':
    if has_permission(user_id, 'pdf_export'):
        from pdf_generator import handle_pdf_export_selected
        await handle_pdf_export_selected(update, context)
```

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `pdf_generator.py` (—Å—Ç—Ä–æ–∫–∏ 358-568)
- `commands.py` (—Å—Ç—Ä–æ–∫–∏ 2005-2020)

---

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –í—ã–±–æ—Ä–æ—á–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç PDF:

1. **–í—ã–±–æ—Ä –î–°–ï:**
   - –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –î–°–ï —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–ø–∏—Å–µ–π
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏
   - –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –î–°–ï (‚úÖ)

2. **–≠–∫—Å–ø–æ—Ä—Ç:**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –î–°–ï
   - –î–æ 10 –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∫–∞–∂–¥—ã–π –î–°–ï
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –î–°–ï/–∑–∞–ø–∏—Å–∏/PDF

3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ `has_permission(user_id, 'pdf_export')`
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∞–≤

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
cd /opt/telegrambot
bash restart-bot.sh

# 2. –í Telegram:
# - –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞
# - –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚Üí –ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# - –í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# - –í—ã–±—Ä–∞—Ç—å –Ω–æ–≤—É—é —Ä–æ–ª—å
# ‚úÖ –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: "–†–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞: [–†–æ–ª—å]"
```

### –¢–µ—Å—Ç 2: –í—ã–±–æ—Ä–æ—á–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç PDF
```bash
# 1. –í Telegram:
# - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF
# - –í—ã–±—Ä–∞—Ç—å –∑–∞–ø–∏—Å–∏
# - –í—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –î–°–ï (–ø–æ—è–≤—è—Ç—Å—è ‚úÖ)
# - –ù–∞–∂–∞—Ç—å "–≠–∫—Å–ø–æ—Ä—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö"
# ‚úÖ –î–æ–ª–∂–Ω—ã –ø—Ä–∏–π—Ç–∏ PDF —Ñ–∞–π–ª—ã
# ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
```

---

## üìä –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ:
1. ‚úÖ Task 1: Web integration (Flask + bot.py)
2. ‚úÖ Task 3: Email button removal
3. ‚úÖ Monitor system (htop-style)
4. ‚úÖ HTTPS automation scripts
5. ‚úÖ Bot domain configuration
6. ‚úÖ Monitor black screen fix
7. ‚úÖ Statistics error fix
8. ‚úÖ PDF export all records
9. ‚úÖ **PDF export select records** (–ù–û–í–û–ï)
10. ‚úÖ **Role change functionality** (–ù–û–í–û–ï)

### ‚è≥ –í –æ–∂–∏–¥–∞–Ω–∏–∏:
- Task 2: nginx 400 error (—Å–∫—Ä–∏–ø—Ç—ã —Å–æ–∑–¥–∞–Ω—ã)
- Task 4: DSE view menu fixes
- Task 5: DSE tracking watched list

---

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   cd /opt/telegrambot
   bash restart-bot.sh
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:**
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –í—ã–±–æ—Ä–æ—á–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç PDF
   - –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π

3. **–û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏:**
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å DSE view menu (Task 4)
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å DSE tracking (Task 5)
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å nginx —Å–∫—Ä–∏–ø—Ç—ã (Task 2)

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (—Å—Ç–∞—Ä—ã–π `role_` handler)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–±–æ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —ç–∫—Å–ø–æ—Ä—Ç–∞
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –º–∞–∫—Å–∏–º—É–º 10 –∑–∞–ø–∏—Å–µ–π –Ω–∞ –î–°–ï –ø—Ä–∏ –≤—ã–±–æ—Ä–æ—á–Ω–æ–º —ç–∫—Å–ø–æ—Ä—Ç–µ

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ context.user_data:
```python
context.user_data[user_id] = {
    'pdf_export_mode': 'select',
    'dse_dict': {
        '–î–°–ï/123': [record1, record2, ...],
        '–î–°–ï/456': [record3, record4, ...]
    },
    'selected_dse': ['–î–°–ï/123', '–î–°–ï/456']
}
```

### –§–æ—Ä–º–∞—Ç callback_data:
- `set_role_<user_id>_<role>` - –≤—ã–±–æ—Ä —Ä–æ–ª–∏
- `pdf_select_dse_<dse_name>` - –≤—ã–±–æ—Ä –î–°–ï (—Å–ª—ç—à –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ –¥–µ—Ñ–∏—Å)
- `pdf_export_selected` - —ç–∫—Å–ø–æ—Ä—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö

---

**–ê–≤—Ç–æ—Ä:** GitHub Copilot  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** ‚úÖ –ë–µ–∑ –æ—à–∏–±–æ–∫ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
